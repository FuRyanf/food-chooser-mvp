import { createContext, useContext, useCallback } from 'react';

export type Language = 'en' | 'zh';

// Language Context
const LanguageContext = createContext<Language>('en');

export const LanguageProvider = LanguageContext.Provider;

export function useLanguage(): Language {
  return useContext(LanguageContext);
}

const TRANSLATION_MAP: Record<string, { zh: string }> = {
  'Home': { zh: '首頁' },
  'Browse': { zh: '瀏覽' },
  'Contributions': { zh: '貢獻' },
  'Overview': { zh: '總覽' },
  'Travel Tags': { zh: '旅行標籤' },
  'Mystery picks & logging': { zh: '神秘推薦與紀錄' },
  'Browse your saved meals': { zh: '瀏覽已儲存的餐點' },
  'Track spending & contributions': { zh: '追蹤支出與分擔' },
  'Track & Decide': { zh: '追蹤與決定' },
  'Budget tracker that chooses for you': { zh: '幫你做選擇的預算追蹤器' },
  "Crack an egg to pick a meal, track spending on meals, groceries & travel, and share budgets with your household.": {
    zh: '敲開神秘蛋選餐點，追蹤餐食、雜貨與旅行支出，與家人共享預算。',
  },
  'New mystery pick ready': { zh: '神秘餐點已準備就緒' },
  'Crack Mystery Egg': { zh: '敲開神秘蛋' },
  'Quick add top pick': { zh: '快速加入推薦餐點' },
  'Mystery egg is ready': { zh: '神秘蛋準備好了' },
  'Ready to crack?': { zh: '準備好要敲蛋了嗎？' },
  'Crack the shell to see today\'s surprise meal.': { zh: '敲開蛋殼，就能看到今日的驚喜餐點。' },
  'FuDi will pick from your shortlist once you crack the egg.': { zh: '敲開蛋殼後，福娣會從精選清單中替你挑出餐點。' },
  'Top choices for you': { zh: '為你精選的餐點' },
  'Mystery Egg': { zh: '神秘彩蛋' },
  'Let FuDi crack a surprise pick or browse your shortlist.': { zh: '讓福娣替你敲出驚喜餐點，或自行瀏覽精選清單。' },
  'Note: crack the egg to see the highlighted meal, or peek at the full list if you want to pick manually.': {
    zh: '提示：敲開神秘蛋即可看到今日亮點餐點，或開啟完整清單自行挑選。',
  },
  'Add a few saved meals to unlock your mystery egg.': { zh: '先儲存幾道餐點，就能啟動神秘彩蛋。' },
  'Explain': { zh: '說明' },
  'See shortlist': { zh: '查看精選清單' },
  'Hide shortlist': { zh: '收起精選清單' },
  'Crack to reveal the meal we’ll spotlight for you. Want to choose yourself? Open the full list.': {
    zh: '敲開就能看見今日 spotlight 餐點，想自己選？打開完整清單吧。',
  },
  'Showing enabled': { zh: '顯示啟用項目' },
  'Hide disabled': { zh: '隱藏停用項目' },
  'Newest': { zh: '最新' },
  'Rating': { zh: '評分' },
  'Cost (low)': { zh: '費用（低到高）' },
  'Sort': { zh: '排序' },
  'Filter by cuisine': { zh: '依料理篩選' },
  'View': { zh: '檢視' },
  'Enabled only': { zh: '僅顯示啟用' },
  'Include disabled': { zh: '包含停用項目' },
  'Search cuisines': { zh: '搜尋料理' },
  'No cuisines match your search.': { zh: '沒有符合搜尋條件的料理。' },
  'All': { zh: '全部' },
  'Clear': { zh: '清除' },
  'Add meals to build cuisine filters.': { zh: '新增餐點以建立料理篩選。' },
  'Applying bulk update…': { zh: '正在套用批次更新…' },
  'Disabled': { zh: '已停用' },
  'Active': { zh: '啟用中' },
  'Enable': { zh: '啟用' },
  'Disable': { zh: '停用' },
  'Saving…': { zh: '儲存中…' },
  'Select': { zh: '選擇' },
  'Save to Meal History': { zh: '存入餐點紀錄' },
  'Choose & Save': { zh: '選擇並儲存' },
  'Switch Language': { zh: '切換語言' },
  'Light': { zh: '淺色' },
  'Dark': { zh: '深色' },
  'Switch to dark theme': { zh: '切換至深色主題' },
  'Switch to light theme': { zh: '切換至淺色主題' },
  'Keep browsing': { zh: '繼續瀏覽' },
  'Sneak peek': { zh: '搶先一瞥' },
  'Hold tight...': { zh: '請稍候…' },
  'FuDi is giving the egg a little shake…': { zh: '福娣正輕輕搖晃著神秘蛋…' },
  'FuDi is peeking inside the egg to find a delicious surprise.': { zh: '福娣正偷看蛋裡的美味驚喜。' },
  'FuDi jiggles the egg to wake up flavors…': { zh: '福娣晃著神秘蛋喚醒味蕾…' },
  'Peeking between the cracks for saucy secrets…': { zh: '從裂縫偷瞄著醬香祕密…' },
  'Consulting the pantry spirits for spice guidance…': { zh: '向儲藏室的小精靈請教香料指引…' },
  'FuDi holding a mystery egg': { zh: '福娣捧著神秘蛋' },
  'FuDi cracked egg backdrop': { zh: '福娣與裂開神秘蛋的背景' },
  'No pick available.': { zh: '目前沒有可用餐點。' },
  'View full list': { zh: '查看完整清單' },
  'Hide list': { zh: '收起清單' },
  'Your Mystery Pick': { zh: '你的神秘餐點' },
  'Suggested': { zh: '推薦餐廳' },
  'Chef\'s Choice': { zh: '主廚精選' },
  'Signature dish': { zh: '招牌餐點' },
  'Comforting bites with a thrifty twist.': { zh: '溫暖安心又精打細算的好味道。' },
  'Balanced picks for everyday cravings.': { zh: '適合每日渴望的均衡選擇。' },
  'Shiny crowd-pleasers with bold flavor.': { zh: '亮眼又大膽的熱門美食。' },
  'Elevated indulgence worthy of a celebration.': { zh: '值得慶祝的高級享受。' },
  'Est.': { zh: '估計' },
  'Close': { zh: '關閉' },
  'Month to Date': { zh: '本月至今' },
  'All Time': { zh: '所有時間' },
  'Custom': { zh: '自訂' },
  'Spending Contributions': { zh: '花費貢獻' },
  'See who\'s been buying meals and groceries': { zh: '查看誰在購買餐點與雜貨' },
  'See who\'s been buying meals, groceries, and travel': { zh: '看看誰在負責餐點、雜貨與旅行支出' },
  'Meals': { zh: '餐點' },
  'Groceries': { zh: '雜貨' },
  'Travel': { zh: '旅行' },
  'Total': { zh: '總計' },
  'Total entries': { zh: '總紀錄' },
  'Total (6 mo)': { zh: '六個月總計' },
  'Spend mix by person': { zh: '個人花費組成' },
  'Shortlist': { zh: '精選清單' },
  'No saved meals yet—log a few to build your shortlist.': { zh: '尚未儲存餐點，先記錄幾道菜來建立精選清單吧。' },
  'Delete saved meal?': { zh: '刪除已儲存的餐點？' },
  'This removes every history entry for this dish.': { zh: '這將刪除此料理的所有歷史紀錄。' },
  'Delete meal entry?': { zh: '刪除這筆餐點紀錄？' },
  'This removes it from your meal history.': { zh: '此紀錄將從餐點歷史中移除。' },
  'Delete grocery entry?': { zh: '刪除這筆雜貨紀錄？' },
  'This removes it from your grocery history.': { zh: '此紀錄將從雜貨歷史中移除。' },
  'Stacked by meals and groceries': { zh: '依餐點與雜貨堆疊顯示' },
  'Stacked by meals, groceries, and travel': { zh: '依餐點、雜貨與旅行堆疊顯示' },
  'Share of total spending': { zh: '佔總花費比例' },
  'Recent transactions': { zh: '最近交易' },
  'Most recent 6 entries in range': { zh: '此範圍內最近 6 筆' },
  'No activity found for this range.': { zh: '此時間範圍內沒有紀錄。' },
  'No spend in this month.': { zh: '本月尚未有花費。' },
  'No travel spend in this range.': { zh: '此範圍內沒有旅行支出。' },
  'Log travel-tagged grocery entries to see insights here.': { zh: '記錄帶有旅行標籤的雜貨支出即可在此查看洞察。' },
  '{count} transactions': { zh: '{count} 筆交易' },
  'Total Travel Spend': { zh: '旅行總支出' },
  'Travel Transactions': { zh: '旅行交易筆數' },
  'Unique Travel Tags': { zh: '不同的旅行標籤' },
  'Top Travel Tag': { zh: '最高金額旅行標籤' },
  'Travel tag contributions': { zh: '旅行標籤貢獻' },
  'Sorted by total spend within selected range': { zh: '依所選範圍的總支出排序' },
  'Per person': { zh: '付款者分佈' },
  'No spending data found': { zh: '查無花費資料' },
  'Try selecting a longer time period or add some meals/groceries with purchaser names': { zh: '試著選擇較長的時間範圍，或新增包含付款者姓名的餐點／雜貨紀錄。' },
  'Browse Meals': { zh: '瀏覽餐點' },
  'Use filters to refine the grid': { zh: '使用篩選條件進一步縮小結果' },
  'Search dish, restaurant, cuisine': { zh: '搜尋餐點、餐廳或料理' },
  'Showing {current} of {total} saved meals': { zh: '顯示 {total} 筆中的 {current} 筆餐點' },
  '{meals} meals · {groceries} groceries': { zh: '餐點 {meals} 道 · 雜貨 {groceries} 筆' },
  'No meals match the current filters. Try adjusting your cuisine toggles or clearing the search.': {
    zh: '目前沒有符合篩選條件的餐點，試著調整料理篩選或清除搜尋。'
  },
  'View Last 5': { zh: '僅看最近五筆' },
  'View All': { zh: '查看全部' },
  'History': { zh: '歷史紀錄' },
  'Log': { zh: '新增紀錄' },
  'Meal': { zh: '餐點' },
  'Grocery Trip': { zh: '雜貨行程' },
  'Grocery': { zh: '雜貨' },
  'Save Changes': { zh: '儲存變更' },
  'Date': { zh: '日期' },
  'Cuisine': { zh: '料理' },
  'Restaurant': { zh: '餐廳' },
  'Dish': { zh: '餐點名稱' },
  'Cost': { zh: '金額' },
  'Last logged': { zh: '最後紀錄' },
  'Who Paid?': { zh: '付款者' },
  'Actions': { zh: '操作' },
  'Notes': { zh: '備註' },
  'Save Meal': { zh: '儲存餐點' },
  'Amount (USD)': { zh: '金額（美元）' },
  'Store': { zh: '商店' },
  'Save Trip': { zh: '儲存雜貨紀錄' },
  'Enter a valid amount': { zh: '請輸入有效的金額' },
  'Grocery trip saved': { zh: '雜貨紀錄已儲存' },
  'Grocery trip updated': { zh: '雜貨紀錄已更新' },
  'Travel entry updated': { zh: '旅行紀錄已更新' },
  'Failed to update travel entry': { zh: '更新旅行紀錄失敗' },
  'Travel Tag': { zh: '旅行標籤' },
  "Mark as seed (won't count toward spend)": { zh: '標記為種子資料（不計入花費）' },
  "Your Snapshot": { zh: '你的快照' },
  'Month-to-date': { zh: '本月累計' },
  'Spent MTD': { zh: '本月已花費' },
  'Remaining': { zh: '剩餘' },
  'Usage': { zh: '使用率' },
  'Spend': { zh: '花費分析' },
  'Previous 6 months': { zh: '前六個月' },
  'Next 6 months': { zh: '後六個月' },
  'Currently viewing a 6-month window': { zh: '目前檢視 6 個月區間' },
  'How we ranked your top choice': { zh: '我們如何為你排名' },
  'How the ranking works': { zh: '排名如何計算' },
  'The score for each meal uses this formula:': { zh: '每一道餐點的分數依下列公式計算：' },
  'Rating weight: (rating or 3) × 10': { zh: '評分權重： (評分或 3) × 10' },
  'Recency penalty: up to −12 for very recent meals': { zh: '近期扣分：非常近期的餐點最多扣 12 分' },
  'Budget fit: +8 if within your saved budget; negative if outside': { zh: '預算適配：符合預算加 8 分，超出則扣分' },
  "Weather bonus: +2 to +3 for cuisines matching today's weather": { zh: '天氣加成：符合今日天氣的料理可加 2 至 3 分' },
  'Random jitter: small ±1.5 to add variety': { zh: '隨機調整：±1.5 分增加多樣性' },
  "Today's context": { zh: '今日情境' },
  'Weather': { zh: '天氣' },
  'Budget': { zh: '預算' },
  'Examples': { zh: '範例' },
  'Rating weight': { zh: '評分權重' },
  'Recency penalty': { zh: '近期扣分' },
  'Budget fit': { zh: '預算適配' },
  'Weather bonus': { zh: '天氣加成' },
  'Jitter': { zh: '隨機值' },
  'Total score': { zh: '總分' },
  'Loading your food data...': { zh: '正在載入你的餐點資料…' },
  'Error': { zh: '錯誤' },
  'Retry': { zh: '重試' },
  'Logged to Meal History': { zh: '已記錄到餐點歷史' },
  'Selected! Added to your Meal History.': { zh: '已選取！加入你的餐點歷史。' },
  'Preferences & budget': { zh: '偏好與預算' },
  'Min': { zh: '最低' },
  'Max': { zh: '最高' },
  'Monthly budget': { zh: '每月預算' },
  'For meals & groceries only (excludes travel)': { zh: '僅用於餐點與雜貨（不含旅行）' },
  'Annual travel budget': { zh: '年度旅行預算' },
  'Tracked separately from monthly spending': { zh: '與每月支出分開追蹤' },
  'Annual travel budget must be a non-negative number.': { zh: '年度旅行預算必須是非負數。' },
  'Annual Travel Budget': { zh: '年度旅行預算' },
  'Spent YTD': { zh: '年初至今已花費' },
  'Saved: {min} – {max}': { zh: '已儲存：{min} – {max}' },
  'Preferences saved.': { zh: '偏好已儲存。' },
  'Failed to save preferences.': { zh: '偏好儲存失敗。' },
  'Save Preferences': { zh: '儲存偏好' },
  'Not set': { zh: '未設定' },
  'No repeat within (days)': { zh: '不可重複天數' },
  '0 (allow repeats)': { zh: '0（允許重複）' },
  'Egg tiers': { zh: '蛋等級' },
  'Eligible': { zh: '符合條件' },
  'Not eligible': { zh: '未符合' },
  'Please enter valid numeric min and max.': { zh: '請輸入有效的最小值與最大值。' },
  'Min and Max must be non-negative.': { zh: '最小值與最大值必須為非負數。' },
  'Max must be greater than or equal to Min.': { zh: '最大值必須大於或等於最小值。' },
  'No repeat within days must be an integer between 0 and 14.': { zh: '不可重複天數需為 0 到 14 的整數。' },
  'Monthly budget must be a non-negative number.': { zh: '每月預算需為非負數。' },
  'Delete': { zh: '刪除' },
  'Edit': { zh: '編輯' },
  'Cancel': { zh: '取消' },
  'Save': { zh: '儲存' },
  'Edit Dinner Entry': { zh: '編輯餐點紀錄' },
  
  // Household Onboarding
  'Welcome to FuDi!': { zh: '歡迎來到福娣！' },
  'Let\'s set up your household to start tracking meals and expenses together.': { zh: '讓我們設定你的家庭帳戶，開始一起追蹤餐點與花費吧。' },
  'Create New Household': { zh: '建立新家庭' },
  'Join Existing Household': { zh: '加入現有家庭' },
  'You can only belong to one household at a time': { zh: '你只能同時屬於一個家庭' },
  'Create Your Household': { zh: '建立你的家庭' },
  'Choose a name for your household. You can invite others later!': { zh: '為你的家庭選擇一個名稱，稍後可以邀請其他人！' },
  'Household Name': { zh: '家庭名稱' },
  'e.g., The Smith Family, Roommates, etc.': { zh: '例如：史密斯家庭、室友們等' },
  'Creating...': { zh: '建立中...' },
  'Create Household': { zh: '建立家庭' },
  '← Back': { zh: '← 返回' },
  'Join a Household': { zh: '加入家庭' },
  'To join an existing household, you\'ll need an invitation.': { zh: '要加入現有家庭，你需要一個邀請連結。' },
  'How to join:': { zh: '如何加入：' },
  'Ask a household member to generate an invite link from their Household Settings': { zh: '請家庭成員從「家庭設定」產生邀請連結' },
  'They\'ll share the invite link with you (via email, text, Slack, etc.)': { zh: '他們會透過電子郵件、簡訊、Slack 等方式分享連結給你' },
  'Click the link to automatically join their household': { zh: '點擊連結即可自動加入他們的家庭' },
  'Note:': { zh: '注意：' },
  'Invite links expire after 7 days and work only once. No automatic emails are sent - links must be shared manually.': { zh: '邀請連結在 7 天後過期，且只能使用一次。系統不會自動發送電子郵件，連結須手動分享。' },
  '← Back to options': { zh: '← 返回選項' },
  'Please enter a household name': { zh: '請輸入家庭名稱' },
  'Please enter your name': { zh: '請輸入你的名字' },
  'Database connection not available': { zh: '資料庫連線無法使用' },
  'Failed to create household': { zh: '建立家庭失敗' },
  'Your Name': { zh: '你的名字' },
  'e.g., Ryan, Sarah, etc.': { zh: '例如：小明、小華等' },
  'Your Profile': { zh: '你的個人檔案' },
  'Display Name': { zh: '顯示名稱' },
  'This name will default as the "Who paid?" in your meal and grocery entries': { zh: '此名稱將預設為你的餐點和購物記錄中的「誰付款？」' },
  'e.g., Ryan, Sarah': { zh: '例如：小明、小華' },
  'Update Name': { zh: '更新名稱' },
  'Saving...': { zh: '儲存中...' },
  'Profile updated successfully!': { zh: '個人檔案更新成功！' },
  'Please enter a name': { zh: '請輸入名稱' },
  'Failed to update profile': { zh: '更新個人檔案失敗' },
  'Enter Invite Code': { zh: '輸入邀請碼' },
  'e.g., ABC123': { zh: '例如：ABC123' },
  'Joining...': { zh: '加入中...' },
  'Join Household': { zh: '加入家庭' },
  'Please enter an invite code': { zh: '請輸入邀請碼' },
  'Invalid invite code': { zh: '邀請碼無效' },
  'How to get a code:': { zh: '如何獲取邀請碼：' },
  'Ask a household owner to generate an invite code from their Household Settings and share it with you.': { zh: '請家庭擁有者從家庭設定中生成邀請碼並分享給你。' },
  
  // Household Settings
  'Household Settings': { zh: '家庭設定' },
  'Manage your profile, household, and members': { zh: '管理你的個人檔案、家庭與成員' },
  'Household name cannot be empty': { zh: '家庭名稱不能為空' },
  'Household name updated!': { zh: '家庭名稱已更新！' },
  'Failed to update household name': { zh: '更新家庭名稱失敗' },
  'Unable to generate invite': { zh: '無法生成邀請' },
  'Failed to generate code': { zh: '生成邀請碼失敗' },
  'Use "Leave Household" button to remove yourself': { zh: '請使用「離開家庭」按鈕來移除自己' },
  'Member removed': { zh: '成員已移除' },
  'Failed to remove member': { zh: '移除成員失敗' },
  'Household deleted. All data has been removed.': { zh: '家庭已刪除。所有資料已移除。' },
  'You have left the household.': { zh: '你已離開家庭。' },
  'Failed to leave household': { zh: '離開家庭失敗' },
  'Invite link copied to clipboard!': { zh: '邀請連結已複製到剪貼板！' },
  'Failed to switch households': { zh: '切換家庭失敗' },
  'Defaults as "Who paid?" in entries': { zh: '預設為紀錄中的「誰付款？」' },
  'Enter your name': { zh: '輸入你的名字' },
  'Updating...': { zh: '更新中...' },
  'Update': { zh: '更新' },
  'Shared with all members': { zh: '與所有成員共享' },
  'My Household': { zh: '我的家庭' },
  'Invite Members': { zh: '邀請成員' },
  'Invite Code:': { zh: '邀請碼：' },
  'Code copied to clipboard!': { zh: '邀請碼已複製到剪貼板！' },
  '📋 Copy Code': { zh: '📋 複製邀請碼' },
  'Or share this link:': { zh: '或分享此連結：' },
  '📋 Copy Link': { zh: '📋 複製連結' },
  'Code and link expire in 7 days. Can be used by multiple people.': { zh: '邀請碼和連結在 7 天後過期。可供多人使用。' },
  '← Hide': { zh: '← 隱藏' },
  'Generate a simple code to invite people to your household': { zh: '生成一個簡單的邀請碼來邀請他人加入你的家庭' },
  'Generating...': { zh: '生成中...' },
  'Generate Invite Code': { zh: '生成邀請碼' },
  'Members ({count})': { zh: '成員 ({count})' },
  '(You)': { zh: '(你)' },
  'Joined': { zh: '加入於' },
  'Remove member': { zh: '移除成員' },
  'Danger Zone': { zh: '危險區域' },
  'Warning:': { zh: '警告：' },
  'You are the last member of this household. Leaving will permanently delete all household data including meals, groceries, preferences, and history.': { zh: '你是此家庭的最後一位成員。離開將會永久刪除所有家庭資料，包括餐點、雜貨、偏好設定及歷史紀錄。' },
  'Leave this household. You can create a new household or join another one after leaving.': { zh: '離開此家庭。離開後你可以建立新的家庭或加入其他家庭。' },
  'Leave Household': { zh: '離開家庭' },
  'Are you absolutely sure?': { zh: '你確定要這麼做嗎？' },
  'Leaving...': { zh: '離開中...' },
  'Yes, Leave Household': { zh: '是的，離開家庭' },
  '💡 How it works:': { zh: '💡 運作方式：' },
  'All household members share meals, groceries, and preferences. Only owners can invite new members. Each person can only belong to one household at a time.': { zh: '所有家庭成員共享餐點、雜貨與偏好設定。只有擁有者可以邀請新成員。每個人一次只能屬於一個家庭。' },
  'Link copied to clipboard!': { zh: '連結已複製到剪貼板！' },
  'Switched to {household_name}!': { zh: '已切換至 {household_name}！' },
  'Customize egg tier boundaries': { zh: '自訂神秘蛋等級界限' },
  'Bronze (under):': { zh: '青銅（低於）：' },
  'Silver (under):': { zh: '白銀（低於）：' },
  'Gold (under):': { zh: '黃金（低於）：' },
  'Diamond (above Gold)': { zh: '鑽石（黃金以上）' },
};

export function translateText(text: string, language: Language): string {
  if (language === 'zh') {
    return TRANSLATION_MAP[text]?.zh ?? text;
  }
  return text;
}

export function translateTemplate(text: string, language: Language, replacements: Record<string, string | number>): string {
  const base = translateText(text, language);
  return Object.entries(replacements).reduce((acc, [key, value]) => acc.replace(`{${key}}`, String(value)), base);
}

// Hook for components to use i18n
export function useI18n() {
  const language = useLanguage();
  const t = useCallback((text: string) => translateText(text, language), [language]);
  const tt = useCallback((text: string, replacements: Record<string, string | number>) => translateTemplate(text, language, replacements), [language]);
  return { t, tt };
}
